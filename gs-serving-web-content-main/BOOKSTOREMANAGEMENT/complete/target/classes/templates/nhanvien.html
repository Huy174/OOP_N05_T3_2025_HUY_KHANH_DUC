<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Quản lý Nhân viên</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body class="container mt-4">

<h2 class="mb-3 text-primary">Quản lý Nhân viên</h2>

<a href="index.html" class="btn btn-secondary btn-sm mb-3">
    <i class="bi bi-arrow-left"></i> Quay lại
</a>

<!-- Tổng nhân viên -->
<div class="alert alert-info d-flex align-items-center">
    <i class="bi bi-people me-2"></i>
    <strong>Tổng nhân viên: </strong> 
    <span id="tongNhanVien" class="ms-1">0</span>
</div>

<!-- Form thêm/sửa nhân viên -->
<div class="card mb-4 shadow-sm">
    <div class="card-header bg-primary text-white">
        <i class="bi bi-person-plus"></i>
        <span>Thêm/Sửa nhân viên</span>
    </div>
    <div class="card-body">
        <form id="formNhanVien">
            <div class="row g-3 mb-3">
                <div class="col-md-3">
                    <label class="form-label">Mã NV:</label>
                    <input type="text" name="maNV" class="form-control" placeholder="Nhập mã NV"/>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Tên NV:</label>
                    <input type="text" name="tenNV" class="form-control" placeholder="Nhập tên NV"/>
                </div>
                <div class="col-md-3">
                    <label class="form-label">Chức vụ:</label>
                    <input type="text" name="chucVu" class="form-control" placeholder="Nhập chức vụ"/>
                </div>
            </div>
            <button type="submit" class="btn btn-success"><i class="bi bi-save"></i> Lưu</button>
        </form>
    </div>
</div>

<!-- Form tìm kiếm -->
<div class="mb-3 d-flex">
    <input type="text" id="timKiemInput" class="form-control me-2" placeholder="Tìm theo mã hoặc tên NV"/>
    <button id="btnTimKiem" class="btn btn-warning"><i class="bi bi-search"></i> Tìm</button>
    <button id="btnHienThiTatCa" class="btn btn-secondary ms-2">Hiển thị tất cả</button>
</div>

<!-- Bảng danh sách nhân viên -->
<h5>Danh sách nhân viên</h5>
<table class="table table-hover table-striped table-bordered align-middle">
    <thead class="table-dark">
        <tr>
            <th>Mã NV</th>
            <th>Tên NV</th>
            <th>Chức vụ</th>
            <th>Hành động</th>
        </tr>
    </thead>
    <tbody id="tableBody">
        <tr>
            <td colspan="4" class="text-center">Chưa có nhân viên nào</td>
        </tr>
    </tbody>
</table>

<script>
const tableBody = document.getElementById('tableBody');
const form = document.getElementById('formNhanVien');
const inputMaNV = form.querySelector('input[name=maNV]');
const inputTenNV = form.querySelector('input[name=tenNV]');
const inputChucVu = form.querySelector('input[name=chucVu]');
const spanTongNhanVien = document.getElementById('tongNhanVien');
const timKiemInput = document.getElementById('timKiemInput');
const btnTimKiem = document.getElementById('btnTimKiem');
const btnHienThiTatCa = document.getElementById('btnHienThiTatCa');

// Load dữ liệu từ LocalStorage
let nhanVienList = JSON.parse(localStorage.getItem('nhanVienList')) || [];

// Reset form
function resetForm(){
    inputMaNV.value = '';
    inputTenNV.value = '';
    inputChucVu.value = '';
}

// Cập nhật tổng nhân viên
function capNhatTongNV(){
    spanTongNhanVien.textContent = nhanVienList.length;
}

// Lưu LocalStorage
function luuLocal(){
    localStorage.setItem('nhanVienList', JSON.stringify(nhanVienList));
}

// Render bảng
function renderTable(data){
    tableBody.innerHTML = '';
    if(data.length === 0){
        tableBody.innerHTML = '<tr><td colspan="4" class="text-center">Chưa có nhân viên nào</td></tr>';
        capNhatTongNV();
        return;
    }
    data.forEach(nv=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${nv.maNV}</td>
            <td>${nv.tenNV}</td>
            <td>${nv.chucVu}</td>
            <td>
                <button class="btn btn-info btn-sm" onclick="sua('${nv.maNV}')">
                    <i class="bi bi-pencil-square"></i> Sửa
                </button>
                <button class="btn btn-danger btn-sm" onclick="xoa('${nv.maNV}')">
                    <i class="bi bi-trash"></i> Xóa
                </button>
            </td>
        `;
        tableBody.appendChild(tr);
    });
    capNhatTongNV();
}

// Thêm / Sửa
function addOrUpdateNV(maNV, tenNV, chucVu){
    const index = nhanVienList.findIndex(nv => nv.maNV === maNV);
    if(index !== -1){
        nhanVienList[index] = {maNV, tenNV, chucVu};
    } else {
        nhanVienList.push({maNV, tenNV, chucVu});
    }
    luuLocal();
    renderTable(nhanVienList);
}

// Xóa
function xoa(maNV){
    if(!confirm('Bạn có chắc muốn xóa?')) return;
    nhanVienList = nhanVienList.filter(nv => nv.maNV !== maNV);
    luuLocal();
    renderTable(nhanVienList);
}

// Sửa
function sua(maNV){
    const nv = nhanVienList.find(nv => nv.maNV === maNV);
    if(nv){
        inputMaNV.value = nv.maNV;
        inputTenNV.value = nv.tenNV;
        inputChucVu.value = nv.chucVu;
    }
}

// Submit form
form.addEventListener('submit', e=>{
    e.preventDefault();
    const maNV = inputMaNV.value.trim();
    const tenNV = inputTenNV.value.trim();
    const chucVu = inputChucVu.value.trim();

    if(!maNV || !tenNV || !chucVu){
        alert('Vui lòng nhập đầy đủ thông tin hợp lệ');
        return;
    }

    addOrUpdateNV(maNV, tenNV, chucVu);
    resetForm();
});

// Tìm kiếm
btnTimKiem.addEventListener('click', ()=>{
    const kw = timKiemInput.value.trim().toLowerCase();
    if(!kw){
        alert('Nhập mã hoặc tên nhân viên để tìm');
        return;
    }
    const result = nhanVienList.filter(nv => nv.maNV.toLowerCase().includes(kw) || nv.tenNV.toLowerCase().includes(kw));
    renderTable(result);
});

// Hiển thị tất cả
btnHienThiTatCa.addEventListener('click', ()=>{
    renderTable(nhanVienList);
    timKiemInput.value = '';
});

// Render lần đầu
renderTable(nhanVienList);
</script>

</body>
</html>
